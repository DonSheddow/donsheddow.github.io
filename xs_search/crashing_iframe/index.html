<!DOCTYPE html>
<html>
<head>
<style>
.hidden {
    display: none;
}

input {
    width: 75%;
}
</style>
</head>

<body>
<script src="index.js"></script>
<script>
    function set_loading() {
        document.getElementById('inputs').classList.add('hidden');
        document.getElementById('loading').classList.remove('hidden');
    }

    function unset_loading() {
        document.getElementById('inputs').classList.remove('hidden');
        document.getElementById('loading').classList.add('hidden');
    }

    window.onload = async function() {
        let f = document.createElement('iframe');
        f.src = IFRAME_URL;
        f.onload = async function() {
            await wait_until_frame_has_loaded();
            await wait(1000);
            console.log("initializing...");
            window.alloc_size = await get_max_alloc_size();
            unset_loading();
        }
        document.body.appendChild(f);
    }

    async function calibrate() {
        set_loading();
        let url = document.getElementById('base_url').value;
        let {size, count} = await tune_for_url(url, alloc_size);
        window.alloc_size = size;
        document.getElementById('base_out').innerHTML = count;
        unset_loading();
    }

    async function test() {
        set_loading();
        let url = document.getElementById('test_url').value;
        let count = await get_it(url, alloc_size);
        document.getElementById('test_out').innerHTML = count;
        unset_loading();
    }
</script>
<div id="inputs" class="hidden">
    <div>
    <label for="base_url">Base URL: </label><input id="base_url" type="text" value="https://sheddow.xyz/flask/bytes?len=1000">
    <span id="base_out"></span>

    <button onclick="calibrate()">Calibrate</button>
    </div>


    <div>
    <label for="test">Test URL: </label><input id="test_url" type="text" value="https://sheddow.xyz/flask/bytes?len=1025">
    <span id="test_out"></span>

    <button onclick="test()">Test</button>
    </div>
</div>
<div id="loading">
    loading...
</div>
</body>
</html>
